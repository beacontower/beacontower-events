{
  "project": "BeaconTower.Events",
  "created": "2025-12-06T17:30:00Z",
  "harness_version": "1.0.0",
  "notes": "Test definitions are IMMUTABLE. Agents cannot modify the 'tests' arrays. Features derived from product requirements (FR-1 through FR-7) and roadmap phases 1-4.",
  "source_documentation": "/home/fredrik/projects/beacontower/product-docs/product/requirements/features/beacontower-events",
  "target_version": "0.1.0",
  "features": [
    {
      "id": "feat-001",
      "name": "CloudEvents Abstractions",
      "description": "Define CloudEvents-based interfaces and wrappers for event publishing and subscription. Package: BeaconTower.Events.Abstractions",
      "status": "pass",
      "startedAt": "2025-12-06T17:35:00Z",
      "completedAt": "2025-12-06T18:15:00Z",
      "tests": [
        "ICloudEventPublisher interface defines PublishAsync(CloudEvent, CancellationToken) method",
        "ICloudEventSubscriber interface defines SubscribeAsync with subject pattern and handler",
        "ICloudEventHandler<TData> interface defines HandleAsync(CloudEvent, TData, CancellationToken) method",
        "CloudEventFactory creates CloudEvents with BeaconTower conventions (source, type pattern)",
        "CloudEventTypeGenerator produces com.beacontower.{entity}.{action} format",
        "EntityCreatedData<T>, EntityUpdatedData<T>, EntityDeletedData<T> data contracts defined",
        "BeaconTower extension attributes (correlationid, userid, username) are supported on CloudEvent"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    },
    {
      "id": "feat-002",
      "name": "In-Memory Implementation",
      "description": "Provide in-memory CloudEvents publisher and subscriber for unit tests. Package: BeaconTower.Events.InMemory",
      "status": "pass",
      "startedAt": "2025-12-07T09:15:00Z",
      "completedAt": "2025-12-07T09:30:00Z",
      "tests": [
        "InMemoryCloudEventPublisher stores CloudEvent instances in memory",
        "InMemoryCloudEventPublisher.PublishedEvents returns all published CloudEvents",
        "InMemoryCloudEventPublisher.ClearEvents() removes all stored events",
        "InMemoryCloudEventSubscriber delivers CloudEvents to registered handlers",
        "InMemoryCloudEventSubscriber supports wildcard pattern matching on CloudEvent type",
        "In-memory implementation enables unit tests without NATS dependency"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    },
    {
      "id": "feat-003",
      "name": "NATS CloudEvents Publishing",
      "description": "Implement CloudEvents publishing with NATS JetStream following CloudEvents NATS Protocol Binding. Package: BeaconTower.Events.Nats",
      "status": "pending",
      "tests": [
        "NatsCloudEventPublisher implements ICloudEventPublisher",
        "PublishAsync sends CloudEvent to NATS JetStream in Structured Content Mode",
        "CloudEvent type is mapped to NATS subject (com.beacontower.device.created -> beacontower.device.created)",
        "JSON format uses CloudNative.CloudEvents.SystemTextJson formatter",
        "Connection pool manages NATS connections (configurable min/max)",
        "Transient failures trigger retry with exponential backoff (default 3 retries)",
        "Publishing latency is under 10ms for 95th percentile"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    },
    {
      "id": "feat-004",
      "name": "NATS CloudEvents Subscription",
      "description": "Implement event subscription with NATS JetStream durable consumers and consumer groups.",
      "status": "pending",
      "tests": [
        "NatsCloudEventSubscriber implements ICloudEventSubscriber",
        "SubscribeAsync creates durable consumer that survives service restarts",
        "Wildcard subscriptions work (* matches single token, > matches multiple)",
        "Consumer groups load-balance messages across service instances",
        "Successful handler execution sends ACK to NATS",
        "Handler exception sends NACK and triggers redelivery",
        "Messages exceeding MaxDeliveryAttempts (default 3) route to {subject}.dlq",
        "MaxConcurrency limits parallel handler execution"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    },
    {
      "id": "feat-005",
      "name": "DI Registration Extensions",
      "description": "ASP.NET Core dependency injection registration methods for publishers and subscribers.",
      "status": "pending",
      "tests": [
        "AddNatsCloudEventPublisher(options) registers NatsCloudEventPublisher as ICloudEventPublisher",
        "AddNatsCloudEventSubscriber(options) registers NatsCloudEventSubscriber as ICloudEventSubscriber",
        "AddInMemoryCloudEvents() registers in-memory implementations for testing",
        "AddCloudEventHandler<TData, THandler>() registers handler with scoped lifetime",
        "Configuration binding from IConfiguration section works correctly",
        "Options validation throws for missing required values (ConnectionString, ServiceName)"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    },
    {
      "id": "feat-006",
      "name": "Observability",
      "description": "Structured logging, Prometheus metrics, and health checks for NATS connectivity.",
      "status": "pending",
      "tests": [
        "Publishing logs CloudEvent type and subject at Debug level",
        "Publishing logs correlationid for distributed tracing",
        "Handler execution logs duration at Debug level",
        "Handler failure logs exception at Error level",
        "events_published_total counter increments on successful publish",
        "events_processing_duration_seconds histogram records handler execution time",
        "NatsHealthCheck reports Healthy when NATS connected",
        "NatsHealthCheck reports Unhealthy when NATS disconnected",
        "AddNatsHealthCheck extension registers health check with ASP.NET Core"
      ],
      "createdAt": "2025-12-06T17:30:00Z"
    }
  ]
}
